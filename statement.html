<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>كشف الحساب | SudanPay</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

<div class="card">
  <h2>كشف الحساب</h2>

  <table>
    <thead>
      <tr>
        <th>التاريخ</th>
        <th>الوقت</th>
        <th>النوع</th>
        <th>المبلغ</th>
        <th>الطرف الآخر</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

  <button onclick="back()">رجوع</button>
</div>

<script src="app.js"></script>
<script>
auth.onAuthStateChanged(user => {
  if (!user) {
    location.href = "index.html";
    return;
  }

  const email = user.email;

  db.collection("transactions")
    .orderBy("time", "desc")
    .onSnapshot(snapshot => {
      list.innerHTML = "";

      snapshot.forEach(doc => {
        const t = doc.data();

        if (t.from === email || t.to === email) {
          const date = t.time.toDate();
          const d = date.toLocaleDateString();
          const tm = date.toLocaleTimeString();

          const type = t.from === email ? "إرسال ⬆️" : "استلام ⬇️";
          const other = t.from === email ? t.to : t.from;

          list.innerHTML += `
            <tr>
              <td>${d}</td>
              <td>${tm}</td>
              <td>${type}</td>
              <td>${t.amount} SDG</td>
              <td>${other}</td>
            </tr>
          `;
        }
      });
    });
});

function back() {
  location.href = "dashboard.html";
}
</script>

</body>
    </html>
